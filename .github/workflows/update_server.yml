on: 
  push:
    branches:
      - main
  schedule:
    - cron: 0 */3 * * *
name: Server.json auto update
jobs:
  json_update:
    name: Sever.json update
    runs-on: ubuntu-latest
    steps:
      - name: Delete workflow runs
        uses: GitRML/delete-workflow-runs@main
        continue-on-error: true
        with:
          retain_days: 1
          keep_minimum_runs: 1
      - name: install lynx
        run: sudo bash -c "apt update && apt install -y lynx wget curl"
      - name: Setup Node JS
        uses: actions/setup-node@v1
        with:
          node-version: 15.x
      - uses: actions/checkout@master
        with:
            ref: main
      - name: Install Node Depedencies
        run: |
          cd workflows/ 
          npm i --no-save
      - name: Check Versions
        run: |
          cd workflows/ 
          node ./Server.js

      - name: Commit Modifications
        continue-on-error: true
        run: |
          git config --global user.email 'github-actions@github.com'
          git config --global user.name 'github-actions[bot]'
          git config --global http.postBuffer 157286400 sslVerify=false
          git add ./Server.json
          git commit -m "Update Server.json" -m "- bedrock Version: ${{ env.bedrock_version }}" -m "- java Version: ${{ env.java_version }}" -m "- PocketMine Version: ${{ env.pocketmine_version }}"
          git push
      # - name: Create Pull Request
      #   id: cpr
      #   uses: peter-evans/create-pull-request@v3
      #   continue-on-error: true
      #   with:
      #     token: ${{ secrets.GITHUB_TOKEN }}
      #     commit-message: Sever.json update
      #     committer: GitHub <noreply@github.com>
      #     author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
      #     signoff: false
      #     branch: Server_${{ github.run_id }}
      #     delete-branch: true
      #     base: main
      #     title: 'Server.json update, check update in ${{ github.run_id }}'
      #     body: |
      #       Update report
      #       - bedrock Version: ${{ env.bedrock_version }}
      #       - java Version: ${{ env.java_version }}
      #       - PocketMine Version: ${{ env.pocketmine_version }}
      #     labels: |
      #       Server_Update
      #     team-reviewers: |
      #       owners
      #       maintainers
      #     draft: false
